function removeSelectedTabsExceptIllustrator(t,e,a,l,n){var i=$(".layui-tab-title li"),r="";i.each(function(){var t=$(this).attr("lay-id"),e=$(this).text();"画师"!==e&&(r+='<input type="checkbox" name="tabOption" value="'+t+'" title="'+e+'">')}),layer.open({type:1,title:"选择要保留的选项卡",content:'<form class="layui-form" id="tabSelectionForm">'+r+"</form>",btn:["确认","取消"],yes:function(e,r){var o=[];$('#tabSelectionForm input[name="tabOption"]:checked').each(function(){o.push($(this).val())}),i.each(function(){var e=$(this).attr("lay-id");"画师"===$(this).text()||o.includes(e)||(t.tabDelete("test-handle",e),delete a[e],delete l[e],delete n[e])}),layer.close(e)},success:function(t,a){e.render()}})}layui.use(["table","jquery","form","layer","element"],function(){var t=layui.table,e=layui.jquery,a=layui.form,l=layui.layer,n=layui.element,i=[],r=[],o={},s={},c={};function d(t,a){e.getJSON(t,function(t){a(t)}).fail(function(){console.error("Failed to load "+t)})}function u(t,a,l){for(var n,i,r=t.slice(0),o=t.length,s=o-a;o-- >s;)n=r[i=Math.floor((o+1)*Math.random())],r[i]=r[o],r[o]=n;return r.slice(s).map((t,a)=>({id:a+1,entry:function(t){if(!e("input[name='Random_checkbox']").is(":checked"))return t;function a(t,e){return(e?"{":"[")+t+(e?"}":"]")}function l(t,e){for(var l=a(t,e),n=0;n<3;n++)Math.random()<1/3&&(l=a(l,e));return l}var n=Math.random();return n<1/6?l(t,!0):n<2/6?l(t,!1):t}(t[l]),disabled:!1}))}e.getJSON("/json/Illustrator.json",function(a){var l=a.画师,n=1;for(var r in l)l.hasOwnProperty(r)&&i.push({id:n++,english:l[r],disabled:!1});t.render({elem:"#illustratorTable",cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"english",title:"画师名",width:600},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:i,page:!0,done:function(){e("#illustratorCount").attr("max",i.length)}})}),e(document).ready(function(){d("/json/customEntries.json",function(a){a.forEach(function(a){var l=a.tabId,i=a.tabName;o[l]=a.entries,n.tabAdd("test-handle",{title:i,content:'<div class="control-container line-wrap"><label for="Rescale-input" class="control-label">抽取个数:</label><input type="number" id="entryCount'+l+'" placeholder="自定义词条数量" class="layui-input" min="0" value="1"><label for="Rescale-input" class="control-label">自定义词条(逗号分隔):</label><textarea id="entryInput'+l+'" placeholder="Enter a custom combination of custom terms, using commas to separate each Tag" class="layui-textarea" style="min-height: 30px;"></textarea><button class="layui-btn layui-btn-primary layui-btn-sm" onclick="generateTable('+l+')">生成词条表格</button></div><hr class="ws-space-16"><div><table id="entryTable'+l+'" lay-filter="entryTable"></table></div>',id:l}),t.render({elem:"#entryTable"+l,cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:a.entries,page:!0}),e("#entryCount"+l).attr("max",a.entries.length)})}),d("/json/tagGroups.json",function(a){a.forEach(function(a){var l=a.tabId,i=a.tabName;s[l]=a.entries,n.tabAdd("test-handle",{title:i,content:'<div class="control-container line-wrap"><label for="Rescale-input" class="control-label">自定义词条组:</label><textarea id="tagGroupInput'+l+'" placeholder="Enter custom terms, one per line" class="layui-textarea" style="min-height: 100px;"></textarea><button class="layui-btn layui-btn-primary layui-btn-sm" onclick="generateTagGroupTable('+l+')">生成词条组表格</button></div><hr class="ws-space-16"><div><table id="tagGroupTable'+l+'" lay-filter="tagGroupTable"></table></div>',id:l}),t.render({elem:"#tagGroupTable"+l,cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:a.entries,page:!0}),e("#entryCount"+l).attr("max",a.entries.length)})}),d("/json/playerConfig.json",function(l){l.forEach(function(l){var i=l.tabId,r=l.tabName;c[i]=l.entries,n.tabAdd("test-handle",{title:r,content:'<div class="control-container line-wrap"><div class="layui-form"><input type="checkbox" name="insertBeforeIllustrator'+i+'" title="放于最前"></div><label for="Rescale-input" class="control-label">自定义角色词条:</label><textarea id="playerInput'+i+'" placeholder="Enter custom terms, separated by commas" class="layui-textarea" style="min-height: 30px;"></textarea><button class="layui-btn layui-btn-primary layui-btn-sm" onclick="generatePlayerTable('+i+')">生成角色表格</button></div><hr class="ws-space-16"><div><table id="playerTable'+i+'" lay-filter="playerTable"></table></div>',id:i}),t.render({elem:"#playerTable"+i,cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:l.entries,page:!0}),a.render("checkbox"),e("#entryCount"+i).attr("max",l.entries.length)})})}),t.on("tool(illustratorTable)",function(t){var a=t.data;"delete"===t.event&&(t.del(),i=i.filter(t=>t.id!==a.id),e("#illustratorCount").attr("max",i.length))}),e("#generateTableBtn").on("click",function(){var a=e("#entryInput").val(),l=e("input[name='Split_artist']").is(":checked")?a.split(","):[a],n=1;r=[],l.forEach(function(t){r.push({id:n++,entry:t.trim(),disabled:!1})}),t.render({elem:"#entryTable",cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:r,page:!0,done:function(){e("#entryCount").attr("max",r.length)}})}),t.on("tool(entryTable)",function(t){var a=t.data;"delete"===t.event&&(t.del(),r=r.filter(t=>t.id!==a.id),e("#entryCount").attr("max",r.length))}),e("#entryCount").on("input",function(){var t=parseInt(e("#entryCount").attr("max"));parseInt(e(this).val())>t&&e(this).val(t)}),e("#illustratorCount").on("input",function(){var t=parseInt(e("#illustratorCount").attr("max"));parseInt(e(this).val())>t&&e(this).val(t)}),e("#illustratorMinCount").on("input",function(){var t=parseInt(e("#illustratorCount").attr("max"));parseInt(e(this).val())>t&&e(this).val(t)}),e("#exportTabBtn").on("click",function(){var t=[];e(".layui-tab-title li").each(function(){var a=e(this).attr("lay-id"),l=e(this).text();o[a]&&t.push({tabId:a,tabName:l,entries:o[a]})});var a="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),l=document.createElement("a");l.setAttribute("href",a),l.setAttribute("download","customEntries.json"),document.body.appendChild(l),l.click(),l.remove()}),e("#importBtn").on("click",function(){e("#importFile").click()}),e("#importFile").on("change",function(a){var i=a.target.files[0];if(i){var r=new FileReader;r.onload=function(a){var i=a.target.result;JSON.parse(i).forEach(function(a){var l=a.tabId,i=a.tabName;o[l]=a.entries,n.tabAdd("test-handle",{title:i,content:'<div class="control-container line-wrap"><label for="Rescale-input" class="control-label">抽取个数:</label><input type="number" id="entryCount'+l+'" placeholder="自定义词条数量" class="layui-input" min="0" value="1"><label for="Rescale-input" class="control-label">自定义词条(逗号分隔):</label><textarea id="entryInput'+l+'" placeholder="Enter a custom combination of custom terms, using commas to separate each Tag" class="layui-textarea" style="min-height: 30px;"></textarea><button class="layui-btn layui-btn-primary layui-btn-sm" onclick="generateTable('+l+')">生成词条表格</button></div><hr class="ws-space-16"><div><table id="entryTable'+l+'" lay-filter="entryTable"></table></div>',id:l}),t.render({elem:"#entryTable"+l,cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:a.entries,page:!0}),e("#entryCount"+l).attr("max",a.entries.length)}),l.msg("导入成功")},r.readAsText(i)}e("#importFile").val("")}),e("#exportTagGroupBtn").on("click",function(){var t=[];e(".layui-tab-title li").each(function(){var a=e(this).attr("lay-id"),l=e(this).text();s[a]&&t.push({tabId:a,tabName:l,entries:s[a]})});var a="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),l=document.createElement("a");l.setAttribute("href",a),l.setAttribute("download","tagGroups.json"),document.body.appendChild(l),l.click(),l.remove()}),e("#importTagGroupBtn").on("click",function(){e("#importTagGroupFile").click()}),e("#importTagGroupFile").on("change",function(a){var i=a.target.files[0];if(i){var r=new FileReader;r.onload=function(a){var i=a.target.result;JSON.parse(i).forEach(function(a){var l=a.tabId,i=a.tabName;s[l]=a.entries,n.tabAdd("test-handle",{title:i,content:'<div class="control-container line-wrap"><label for="Rescale-input" class="control-label">自定义词条组:</label><textarea id="tagGroupInput'+l+'" placeholder="Enter custom terms, one per line" class="layui-textarea" style="min-height: 100px;"></textarea><button class="layui-btn layui-btn-primary layui-btn-sm" onclick="generateTagGroupTable('+l+')">生成词条组表格</button></div><hr class="ws-space-16"><div><table id="tagGroupTable'+l+'" lay-filter="tagGroupTable"></table></div>',id:l}),t.render({elem:"#tagGroupTable"+l,cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:a.entries,page:!0}),e("#entryCount"+l).attr("max",a.entries.length)}),l.msg("导入成功")},r.readAsText(i)}e("#importTagGroupFile").val("")}),window.generateTable=function(a){var l=e("#entryInput"+a).val().split(",").filter(t=>""!==t.trim()),n=[];l.forEach(function(t,e){n.push({id:e+1,entry:t.trim(),disabled:!1})}),t.render({elem:"#entryTable"+a,cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:n,page:!0}),o[a]=n,e("#entryCount"+a).on("input",function(){var t=o[a].length;parseInt(e(this).val())>t&&e(this).val(t)})},e("#addTabBtn").on("click",function(){l.prompt({title:"输入新类别名称",formType:0},function(t,e){var a=(new Date).getTime();o[a]=[],n.tabAdd("test-handle",{title:t,content:'<div class="control-container line-wrap"><label for="Rescale-input" class="control-label">抽取个数:</label><input type="number" id="entryCount'+a+'" placeholder="自定义词条数量" class="layui-input" min="0"><label for="Rescale-input" class="control-label">自定义词条(逗号分隔):</label><textarea id="entryInput'+a+'" placeholder="Enter a custom combination of custom terms, using commas to separate each Tag" class="layui-textarea" style="min-height: 30px;"></textarea><button class="layui-btn layui-btn-primary layui-btn-sm" onclick="generateTable('+a+')">生成词条表格</button></div><hr class="ws-space-16"><div><table id="entryTable'+a+'" lay-filter="entryTable"></table></div>',id:a}),n.tabChange("test-handle",a),l.close(e)})}),e("#addTagGroupBtn").on("click",function(){l.prompt({title:"输入词条组名称",formType:0},function(t,e){var a=(new Date).getTime(),i="词条组-"+t;s[a]=[],n.tabAdd("test-handle",{title:i,content:'<div class="control-container  line-wrap"><label for="Rescale-input" class="control-label">自定义词条组:</label><textarea id="tagGroupInput'+a+'" placeholder="Enter custom terms, one per line" class="layui-textarea" style="min-height: 100px;"></textarea><button class="layui-btn layui-btn-primary layui-btn-sm" onclick="generateTagGroupTable('+a+')">生成词条组表格</button></div><hr class="ws-space-16"><div><table id="tagGroupTable'+a+'" lay-filter="tagGroupTable"></table></div>',id:a}),n.tabChange("test-handle",a),l.close(e)})}),e("#addPlayerBtn").on("click",function(){l.prompt({title:"输入选项卡名称",formType:0},function(t,e){var i=(new Date).getTime(),r="角色-"+t;c[i]=[],n.tabAdd("test-handle",{title:r,content:'<div class="control-container line-wrap"><div class="layui-form"><input type="checkbox" name="insertBeforeIllustrator'+i+'" title="放于最前"></div><label for="Rescale-input" class="control-label">自定义角色词条:</label><textarea id="playerInput'+i+'" placeholder="Enter custom terms, separated by commas" class="layui-textarea" style="min-height: 30px;"></textarea><button class="layui-btn layui-btn-primary layui-btn-sm" onclick="generatePlayerTable('+i+')">生成角色表格</button></div><hr class="ws-space-16"><div><table id="playerTable'+i+'" lay-filter="playerTable"></table></div>',id:i}),a.render(),n.tabChange("test-handle",i),l.close(e)})}),window.generatePlayerTable=function(a){var l=e("#playerInput"+a).val().split(",").filter(t=>""!==t.trim()),n=[];l.forEach(function(t,e){n.push({id:e+1,entry:t.trim(),disabled:!1})}),t.render({elem:"#playerTable"+a,cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:n,page:!0}),c[a]=n},e("#exportPlayerBtn").on("click",function(){var t=[];e(".layui-tab-title li").each(function(){var a=e(this).attr("lay-id"),l=e(this).text();c[a]&&t.push({tabId:a,tabName:l,entries:c[a]})});var a="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),l=document.createElement("a");l.setAttribute("href",a),l.setAttribute("download","playerConfig.json"),document.body.appendChild(l),l.click(),l.remove()}),e("#importPlayerBtn").on("click",function(){e("#importPlayerFile").click()}),e("#RemoveDefaultTab").on("click",function(){removeSelectedTabsExceptIllustrator(layui.element,layui.form,o,s,c)}),e("#importPlayerFile").on("change",function(i){var r=i.target.files[0];if(r){var o=new FileReader;o.onload=function(i){var r=i.target.result;JSON.parse(r).forEach(function(l){var i=l.tabId,r=l.tabName;c[i]=l.entries,n.tabAdd("test-handle",{title:r,content:'<div class="control-container line-wrap"><div class="layui-form"><input type="checkbox" name="insertBeforeIllustrator'+i+'" title="放于最前"></div><label for="Rescale-input" class="control-label">自定义角色词条:</label><textarea id="playerInput'+i+'" placeholder="Enter custom terms, separated by commas" class="layui-textarea" style="min-height: 30px;"></textarea><button class="layui-btn layui-btn-primary layui-btn-sm" onclick="generatePlayerTable('+i+')">生成角色表格</button></div><hr class="ws-space-16"><div><table id="playerTable'+i+'" lay-filter="playerTable"></table></div>',id:i}),t.render({elem:"#playerTable"+i,cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:l.entries,page:!0}),a.render(),e("#entryCount"+i).attr("max",l.entries.length)}),l.msg("导入成功")},o.readAsText(r)}e("#importPlayerFile").val("")}),window.generateTagGroupTable=function(a){var l=e("#tagGroupInput"+a).val().split("\n").filter(t=>""!==t.trim()),n=[];l.forEach(function(t,e){n.push({id:e+1,entry:t.trim(),disabled:!1})}),t.render({elem:"#tagGroupTable"+a,cols:[[{field:"id",title:"ID",width:80,sort:!0},{field:"entry",title:"词条",width:460},{field:"delete",title:"操作",width:80,templet:"#deleteBtnTpl"}]],data:n,page:!0}),s[a]=n},t.on("tool(tagGroupTable)",function(t){var e=t.data;if("delete"===t.event){t.del();var a=t.config.id.replace("tagGroupTable","");s[a]=s[a].filter(t=>t.id!==e.id)}}),e("#getTerms").on("click",function(){var t=Object.keys(s);if(0!==t.length){var a=t[Math.floor(Math.random()*t.length)],n=s[a];void 0===n.currentIndex&&(n.currentIndex=0);var d=n[n.currentIndex].entry;n.currentIndex=(n.currentIndex+1)%n.length;var p=parseInt(e("#illustratorCount").val());if(isNaN(p)&&(p=5),p>i.length)l.msg("抽取数量不能超过画师词条的数量");else if(p<m)l.msg("抽取数量不能小于最小抽取数量");else{if(e("input[name='Random_range']").is(":checked")){var m=parseInt(e("#illustratorMinCount").val());isNaN(m)&&(m=1),p=Math.floor(Math.random()*(p-m+1))+m,console.log(p)}var b=[],h=parseInt(e("#entryCount").val());if(h>0){if(h>r.length)return void l.msg("抽取数量不能超过自定义词条的数量");b=u(r,h,"entry").map(t=>t.entry),console.log("Random Entries",b),console.log("entryTableData",r)}for(var f in o){var y=parseInt(e("#entryCount"+f).val());if(y>0){var v=o[f];if(y>v.length)return void l.msg("抽取数量不能超过自定义词条的数量");var g=u(v,y,"entry").map(t=>t.entry);b=b.concat(g),console.log("Random Custom Entries",g)}}var T=u(i,p,"english").map(t=>t.entry),x=[],w=!1;for(var f in c){var I=c[f].map(t=>t.entry);if(I.length>0){var k=I[Math.floor(Math.random()*I.length)];x.push(k)}w=e("input[name='insertBeforeIllustrator"+f+"']").is(":checked")}var C=[];e("input[name='Artist_position']").is(":checked")?w?(C=x.concat(T).concat(b).concat([d]),console.log("Result Entries1",C)):(C=T.concat(x).concat(b).concat([d]),console.log("Result Entries2",C)):w?(C=x.concat(b).concat(T).concat([d]),console.log("Result Entries3",C)):(C=[d].concat(x).concat(b).concat(T),console.log("Result Entries4",C)),e("#tagarea").val(C.join(", "))}}else l.msg("没有可用的词条组")}),e("#randomSelectBtn").on("click",function(){var t=parseInt(e("#entryCount").val()),a=parseInt(e("#illustratorCount").val());if(isNaN(a)&&(a=5),a>i.length)l.msg("抽取数量不能超过画师词条的数量");else{if(e("input[name='Random_range']").is(":checked")){var n=parseInt(e("#illustratorMinCount").val());isNaN(n)&&(n=1),a=Math.floor(Math.random()*(a-n+1))+n,console.log(a)}var s=[];if(t>0){if(t>r.length)return void l.msg("抽取数量不能超过自定义词条的数量");s=u(r,t,"entry")}for(var d in o){var p=parseInt(e("#entryCount"+d).val());if(p>0){var m=o[d];if(p>m.length)return void l.msg("抽取数量不能超过自定义词条的数量");var b=u(m,p,"entry");s=s.concat(b)}}var h=u(i,a,"english"),f=[],y=!1,v=!1;for(var d in c){var g=c[d].map(t=>t.entry);if(g.length>0){var T=g[Math.floor(Math.random()*g.length)];f.push({entry:T}),v||(y=e("input[name='insertBeforeIllustrator"+d+"']").is(":checked"),v=!0)}}var x=e("input[name='Artist_position']").is(":checked");e("input[name='Random_sort']").is(":checked")&&(s=function(t){for(let e=t.length-1;e>0;e--){const a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}return t}(s));var w=[];w=x?y?f.concat(h).concat(s):h.concat(f).concat(s):y?f.concat(s).concat(h):s.concat(f).concat(h),console.log("Final Result Entries",w),e("#tagarea").val(w.map(t=>t.entry).join(", "))}}),n.on("tabDelete(test-handle)",function(t){var a=e(this).parent().attr("lay-id");delete o[a],delete s[a],delete c[a]})});