function fetchAndProcessData(){fetch("/api/select_random",{method:"GET"}).then(e=>e.json()).then(e=>{const t=e.join(", ");document.getElementById("tagarea").value=t}).catch(e=>console.error("Error:",e))}document.getElementById("downloadAll").addEventListener("click",async function(){if(window.Worker){let e=new JSZip,t=document.getElementById("img-preview").getElementsByTagName("img"),n=[],a=[];for(let e=0;e<t.length;e++){let o=t[e];o.src.startsWith("data:image")?a.push({src:o.src,fileName:"image"+(e+1)+".png"}):o.src.startsWith("http")&&n.push({src:o.src,fileName:"image"+(e+1)+".png"})}let o=new Worker("static/js/worker.js");o.postMessage({base64Images:a,imageUrls:n}),o.onmessage=function(t){let{blobs:n}=t.data;n.forEach(t=>{e.file(t.fileName,t.blob)}),e.generateAsync({type:"blob"}).then(function(e){saveAs(e,"images.zip")})}}else alert("Your browser does not support Web Workers.")}),document.addEventListener("DOMContentLoaded",e=>{localStorage.getItem("tagarea")&&(document.getElementById("tagarea").value=localStorage.getItem("tagarea")),localStorage.getItem("tagarea2")&&(document.getElementById("tagarea2").value=localStorage.getItem("tagarea2")),document.getElementById("tagarea").addEventListener("input",function(){localStorage.setItem("tagarea",this.value)}),document.getElementById("tagarea2").addEventListener("input",function(){localStorage.setItem("tagarea2",this.value)})}),document.getElementById("expandableTrigger").addEventListener("click",function(){var e=document.getElementById("uploadArea");"none"===e.style.display?e.style.display="block":e.style.display="none"}),layui.use("element",function(){layui.element.on("tab(demoTab)",function(e){document.querySelectorAll(".layui-tab-title li button").forEach(function(e){e.style.display="none"});"11"!==this.getAttribute("lay-id")&&"33"!==this.getAttribute("lay-id")||this.querySelectorAll("button").forEach(function(e){e.style.display="inline-block"})}),document.querySelector(".layui-tab-title li").querySelectorAll("button").forEach(function(e){e.style.display="inline-block"})}),layui.use(["layer","miniTab","echarts"],function(){var e=layui.jquery,t=(layui.layer,layui.miniTab);layui.echarts;t.listen(),e("body").on("click",".layuimini-notice",function(){var t=e(this).children(".layuimini-notice-title").text(),n=e(this).children(".layuimini-notice-extra").text(),a='<div style="padding:15px 20px; text-align:justify; line-height: 22px;border-bottom:1px solid #e2e2e2;background-color: #2f4056;color: #ffffff">\n<div style="text-align: center;margin-bottom: 20px;font-weight: bold;border-bottom:1px solid #b5d5ff;padding-bottom: 5px"><h4 class="text-danger">'+t+'</h4></div>\n<div style="font-size: 12px">'+e(this).children(".layuimini-notice-content").html()+"</div>\n</div>\n";parent.layer.open({type:1,title:'系统公告<span style="float: right;right: 1px;font-size: 12px;color: #b1b3b9;margin-top: 1px">'+n+"</span>",area:"300px;",shade:.8,id:"layuimini-notice",btn:["取消"],btnAlign:"c",moveType:1,content:a,success:function(e){e.find(".layui-layer-btn").find(".layui-layer-btn1").attr({href:"https://space.bilibili.com/487156342",target:"_blank"})}})}),window.onresize=function(){echartsRecords.resize()},e(document).ready(function(){e("#prompt_notebook").on("click",function(){e.ajax({url:"/api/get_texts",type:"GET",success:function(e){var t,n;t=e.texts,n='<div class="custom-layer-container"><div class="custom-sidebar">',t.forEach(function(e,t){n+='<button onclick="showTextGroup('+(t+1)+')">'+e.title+"</button>"}),n+='</div><div class="custom-content">',t.forEach(function(e,t){n+='<div id="group'+(t+1)+'_text1" class="custom-text-box" style="display: none;"><p>'+e.text_content1+"</p></div>",n+='<div id="group'+(t+1)+'_text2" class="custom-text-box" style="display: none;"><p>'+e.text_content2+"</p></div>",n+='<button id="delete'+(t+1)+'_text" onclick="deleteText(\''+e.title+"', "+(t+1)+')" style="display: none;">删除</button>',n+='<button id="add'+(t+1)+'_text" onclick="add(\''+e.title+"', "+(t+1)+')" style="display: none;">添加到绘图Tag</button>'}),n+="</div></div>",layui.use("layer",function(){var e=layui.layer,t="50%";window.matchMedia("(max-width: 768px)").matches&&(t="100%"),e.open({type:1,title:"词条笔记本",area:[t,"100%"],offset:"rt",shade:.6,shadeClose:!0,content:n})})},error:function(e){console.error("An error occurred: "+e.status+" "+e.statusText)}})})})});var $=layui.jquery;function showTextGroup(e){$(".custom-text-box").hide(),$('button[onclick^="deleteText"]').hide(),$('button[onclick^="add"]').hide(),$("#group"+e+"_text1").show(),$("#group"+e+"_text2").show(),$("#delete"+e+"_text").show(),$("#add"+e+"_text").show()}function deleteText(e,t){$.ajax({url:"/api/delete_text",type:"POST",contentType:"application/json",data:JSON.stringify({title:e}),success:function(n){$(t).parent().remove(),$("#group"+e).remove(),alert("删除成功,将在下次打开时移除")},error:function(e){console.error("删除失败: "+e.status+" "+e.statusText)}})}function add(e,t){var n=$("#group"+t+"_text1").text(),a=$("#group"+t+"_text2").text();$("#tagarea").val(n),$("#tagarea2").val(a)}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("tagarea"),t=document.getElementById("custom-context-menu");document.addEventListener("click",function(e){t.style.display="none"}),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?e.removeEventListener("contextmenu",function(e){e.preventDefault()}):e.addEventListener("contextmenu",function(e){var n,a;return e.preventDefault(),n=e.pageX,a=e.pageY,t.style.left=`${n}px`,t.style.top=`${a}px`,t.style.display="block",!1}),window.increaseWeight=function(){var t=e.value,n=e.selectionStart,a=e.selectionEnd,o=t.substring(n,a),i=/\[(.*?)\]/;o=i.test(o)?o.replace(i,"$1"):"{"+o+"}",e.value=t.substring(0,n)+o+t.substring(a)},window.decreaseWeight=function(){var t=e.value,n=e.selectionStart,a=e.selectionEnd,o=t.substring(n,a),i=/\{(.*?)\}/;o=i.test(o)?o.replace(i,"$1"):"["+o+"]",e.value=t.substring(0,n)+o+t.substring(a)},window.annotateText=function(){var t=e.value,n=e.selectionStart,a=e.selectionEnd,o=t.substring(n,a);o&&(e.value=t.substring(0,n)+"/*"+o+"*/"+t.substring(a))},window.unannotateText=function(){var t=e.value,n=e.selectionStart,a=e.selectionEnd,o=t.substring(n,a);e.value=t.substring(0,n)+o.replace(/\/\*(.*?)\*\//g,"$1")+t.substring(a)},document.getElementById("copy_prompt").addEventListener("click",function(){var n=e.selectionStart,a=e.selectionEnd,o=e.value.substring(n,a);navigator.clipboard.writeText(o).then(function(){layer.msg("复制成功"),t.style.display="none"},function(e){layer.msg("复制失败:",e)})}),document.getElementById("paste_prompt").addEventListener("click",function(){navigator.clipboard.readText().then(function(n){var a=e.selectionStart,o=e.selectionEnd;e.value=e.value.substring(0,a)+n+e.value.substring(o),e.selectionStart=e.selectionEnd=a+n.length,t.style.display="none",layer.msg("粘贴成功")}).catch(function(e){layer.msg("粘贴失败:",e)})}),document.getElementById("cut_prompt").addEventListener("click",function(){var n=e.selectionStart,a=e.selectionEnd,o=e.value.substring(n,a);navigator.clipboard.writeText(o).then(function(){layer.msg("剪切成功"),e.value=e.value.substring(0,n)+e.value.substring(a),e.selectionStart=e.selectionEnd=n,t.style.display="none"},function(e){layer.msg("剪切失败:",e)})}),document.getElementById("select-all").addEventListener("click",function(){e.select(),t.style.display="none"})}),document.addEventListener("DOMContentLoaded",function(){var e=sessionStorage.getItem("userOpus");null!==e&&(document.getElementById("userOpus").innerHTML="Opus: "+e)}),layui.use(["jquery"],function(){var e=layui.jquery,t=e("#select_random"),n=e("#Random_Tag");t.on("click",function(){n.is(":hidden")?n.show():n.hide()})}),layui.use(function(){var e=layui.form;layui.layer;e.on("checkbox(Auto_random)",function(t){1==t.elem.checked&&($("input[name='Auto_polling']").prop("checked",!1),e.render("checkbox"))}),e.on("checkbox(Auto_polling)",function(t){1==t.elem.checked&&($("input[name='Auto_random']").prop("checked",!1),e.render("checkbox"))})}),document.addEventListener("keydown",function(e){const t=e.target.tagName.toLowerCase(),n=document.getElementById("brushSize"),a=parseInt(n.value);if("input"!==t&&"textarea"!==t&&!e.target.isContentEditable)switch(e.key){case"s":document.getElementById("exportMask").click();break;case"b":e.ctrlKey&&document.getElementById("remove_background").click();break;case"z":e.ctrlKey&&document.getElementById("undoBtn").click();break;case"y":e.ctrlKey&&document.getElementById("redoBtn").click();break;case"c":document.getElementById("clearBtn").click();break;case"e":document.getElementById("eraserBtn").click();break;case"i":document.getElementById("colorPickerBtn").click();break;case"=":a<parseInt(n.max)&&(n.value=a+1);break;case"-":a>parseInt(n.min)&&(n.value=a-1)}});